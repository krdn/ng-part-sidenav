{
  "id": "guide/singleton-services",
  "title": "Singleton services",
  "contents": "\n\n\n  <div class=\"github-links\">\n    <a href=\"https://github.com/angular/angular/edit/master/aio/content/guide/singleton-services.md?message=docs%3A%20describe%20your%20change...\" aria-label=\"Suggest Edits\" title=\"Suggest Edits\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n  </div>\n\n\n<div class=\"content\">\n<h1 id=\"singleton-services\">Singleton services<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/singleton-services#singleton-services\"><i class=\"material-icons\">link</i></a></h1>\n<h4 id=\"prerequisites\">Prerequisites:<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/singleton-services#prerequisites\"><i class=\"material-icons\">link</i></a></h4>\n<ul>\n<li>A basic understanding of <a href=\"guide/bootstrapping\">Bootstrapping</a>.</li>\n<li>Familiarity with <a href=\"guide/providers\">Providers</a>.</li>\n</ul>\n<p>For a sample app using the app-wide singleton service that this page describes, see the\n<live-example name=\"ngmodules\"></live-example> showcasing all the documented features of NgModules.</p>\n<hr>\n<h2 id=\"providing-a-singleton-service\">Providing a singleton service<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/singleton-services#providing-a-singleton-service\"><i class=\"material-icons\">link</i></a></h2>\n<p>There are two ways to make a service a singleton in Angular:</p>\n<ul>\n<li>Declare that the service should be provided in the application root.</li>\n<li>Include the service in the <code>AppModule</code> or in a module that is only imported by the <code>AppModule</code>.</li>\n</ul>\n<p>Beginning with Angular 6.0, the preferred way to create a singleton service is to specify on the service that it should be provided in the application root. This is done by setting <code><a href=\"api/core/Injectable#providedIn\" class=\"code-anchor\">providedIn</a></code> to <code>root</code> on the service's <code>@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a></code> decorator:</p>\n<code-example path=\"providers/src/app/user.service.0.ts\" header=\"src/app/user.service.0.ts\" linenums=\"false\">\nimport { <a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a> } from '@angular/core';\n\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>({\n  <a href=\"api/core/Injectable#providedIn\" class=\"code-anchor\">providedIn</a>: 'root',\n})\nexport class UserService {\n}\n\n\n</code-example>\n<p>For more detailed information on services, see the <a href=\"tutorial/toh-pt4\">Services</a> chapter of the\n<a href=\"tutorial\">Tour of Heroes tutorial</a>.</p>\n<h2 id=\"forroot\"><code><a href=\"api/router/RouterModule#forRoot\" class=\"code-anchor\">forRoot()</a></code><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/singleton-services#forroot\"><i class=\"material-icons\">link</i></a></h2>\n<p>If a module provides both providers and declarations (components, directives, pipes) then loading it in a child injector such as a route, would duplicate the provider instances. The duplication of providers would cause issues as they would shadow the root instances, which are probably meant to be singletons. For this reason Angular provides a way to separate providers out of the module so that same module can be imported into the root module with <code>providers</code> and child modules without <code>providers</code>.</p>\n<ol>\n<li>Create a static method <code><a href=\"api/router/RouterModule#forRoot\" class=\"code-anchor\">forRoot()</a></code> (by convention) on the module.</li>\n<li>Place the providers into the <code>forRoot</code> method as follows.</li>\n</ol>\n<!-- MH: show a simple example how to do that without going to deep into it. -->\n<p>To make this more concrete, consider the <code><a href=\"api/router/RouterModule\" class=\"code-anchor\">RouterModule</a></code> as an example. <code><a href=\"api/router/RouterModule\" class=\"code-anchor\">RouterModule</a></code> needs to provide the <code><a href=\"api/router/Router\" class=\"code-anchor\">Router</a></code> service, as well as the <code><a href=\"api/router/RouterOutlet\" class=\"code-anchor\">RouterOutlet</a></code> directive. <code><a href=\"api/router/RouterModule\" class=\"code-anchor\">RouterModule</a></code> has to be imported by the root application module so that the application has a <code><a href=\"api/router/Router\" class=\"code-anchor\">Router</a></code> and the application has at least one <code><a href=\"api/router/RouterOutlet\" class=\"code-anchor\">RouterOutlet</a></code>. It also must be imported by the individual route components so that they can place <code><a href=\"api/router/RouterOutlet\" class=\"code-anchor\">RouterOutlet</a></code> directives into their template for sub-routes.</p>\n<p>If the <code><a href=\"api/router/RouterModule\" class=\"code-anchor\">RouterModule</a></code> didnâ€™t have <code><a href=\"api/router/RouterModule#forRoot\" class=\"code-anchor\">forRoot()</a></code> then each route component would instantiate a new <code><a href=\"api/router/Router\" class=\"code-anchor\">Router</a></code> instance, which would break the application as there can only be one <code><a href=\"api/router/Router\" class=\"code-anchor\">Router</a></code>. For this reason, the <code><a href=\"api/router/RouterModule\" class=\"code-anchor\">RouterModule</a></code> has the <code><a href=\"api/router/RouterOutlet\" class=\"code-anchor\">RouterOutlet</a></code> declaration so that it is available everywhere, but the <code><a href=\"api/router/Router\" class=\"code-anchor\">Router</a></code> provider is only in the <code><a href=\"api/router/RouterModule#forRoot\" class=\"code-anchor\">forRoot()</a></code>. The result is that the root application module imports <code>RouterModule.forRoot(...)</code> and gets a <code><a href=\"api/router/Router\" class=\"code-anchor\">Router</a></code>, whereas all route components import <code><a href=\"api/router/RouterModule\" class=\"code-anchor\">RouterModule</a></code> which does not include the <code><a href=\"api/router/Router\" class=\"code-anchor\">Router</a></code>.</p>\n<p>If you have a module which provides both providers and declarations, use this pattern to separate them out.</p>\n<p>A module that adds providers to the application can offer a\nfacility for configuring those providers as well through the\n<code><a href=\"api/router/RouterModule#forRoot\" class=\"code-anchor\">forRoot()</a></code> method.</p>\n<p><code><a href=\"api/router/RouterModule#forRoot\" class=\"code-anchor\">forRoot()</a></code> takes a service configuration object and returns a\n<a href=\"api/core/ModuleWithProviders\">ModuleWithProviders</a>, which is\na simple object with the following properties:</p>\n<ul>\n<li><code>ngModule</code>: in this example, the <code>CoreModule</code> class.</li>\n<li><code>providers</code>: the configured providers.</li>\n</ul>\n<p>In the <live-example name=\"ngmodules\">live example</live-example>\nthe root <code>AppModule</code> imports the <code>CoreModule</code> and adds the\n<code>providers</code> to the <code>AppModule</code> providers. Specifically,\nAngular accumulates all imported providers\nbefore appending the items listed in <code>@<a href=\"api/core/NgModule#providers\" class=\"code-anchor\">NgModule.providers</a></code>.\nThis sequence ensures that whatever you add explicitly to\nthe <code>AppModule</code> providers takes precedence over the providers\nof imported modules.</p>\n<p>Import <code>CoreModule</code> and use its <code><a href=\"api/router/RouterModule#forRoot\" class=\"code-anchor\">forRoot()</a></code> method one time, in <code>AppModule</code>, because it registers services and you only want to register those services one time in your app. If you were to register them more than once, you could end up with multiple instances of the service and a runtime error.</p>\n<p>You can also add a <code><a href=\"api/router/RouterModule#forRoot\" class=\"code-anchor\">forRoot()</a></code> method in the <code>CoreModule</code> that configures\nthe core <code>UserService</code>.</p>\n<p>In the following example, the optional, injected <code>UserServiceConfig</code>\nextends the core <code>UserService</code>. If a <code>UserServiceConfig</code> exists, the <code>UserService</code> sets the user name from that config.</p>\n<code-example path=\"ngmodules/src/app/core/user.service.ts\" region=\"ctor\" header=\"src/app/core/user.service.ts (constructor)\" linenums=\"false\">\nconstructor(@<a href=\"api/core/Optional\" class=\"code-anchor\">Optional</a>() <a href=\"api/router/Router#config\" class=\"code-anchor\">config</a>: UserServiceConfig) {\n  if (<a href=\"api/router/Router#config\" class=\"code-anchor\">config</a>) { this._userName = config.userName; }\n}\n\n</code-example>\n<p>Here's <code><a href=\"api/router/RouterModule#forRoot\" class=\"code-anchor\">forRoot()</a></code> that takes a <code>UserServiceConfig</code> object:</p>\n<code-example path=\"ngmodules/src/app/core/core.module.ts\" region=\"for-root\" header=\"src/app/core/core.module.ts (forRoot)\" linenums=\"false\">\n<a href=\"api/upgrade/static\" class=\"code-anchor\">static</a> forRoot(<a href=\"api/router/Router#config\" class=\"code-anchor\">config</a>: UserServiceConfig): <a href=\"api/core/ModuleWithProviders\" class=\"code-anchor\">ModuleWithProviders</a> {\n  return {\n    ngModule: CoreModule,\n    providers: [\n      {provide: UserServiceConfig, useValue: <a href=\"api/router/Router#config\" class=\"code-anchor\">config</a> }\n    ]\n  };\n}\n\n</code-example>\n<p>Lastly, call it within the <code><a href=\"api/core/NgModule#imports\" class=\"code-anchor\">imports</a></code> list of the <code>AppModule</code>.</p>\n<code-example path=\"ngmodules/src/app/app.module.ts\" region=\"import-for-root\" header=\"src/app/app.module.ts (imports)\" linenums=\"false\">\nimport { CoreModule } from './core/core.module';\n/* . . . */\n@<a href=\"api/core/NgModule\" class=\"code-anchor\">NgModule</a>({\n  <a href=\"api/core/NgModule#imports\" class=\"code-anchor\">imports</a>: [\n    <a href=\"api/platform-browser/BrowserModule\" class=\"code-anchor\">BrowserModule</a>,\n    ContactModule,\n    CoreModule.forRoot({userName: 'Miss Marple'}),\n    AppRoutingModule\n  ],\n/* . . . */\n})\nexport class AppModule { }\n\n</code-example>\n<p>The app displays \"Miss Marple\" as the user instead of the default \"Sherlock Holmes\".</p>\n<p>Remember to <em>import</em> <code>CoreModule</code> as a Javascript import at the top of the file; don't add it to more than one <code>@<a href=\"api/core/NgModule\" class=\"code-anchor\">NgModule</a></code> <code><a href=\"api/core/NgModule#imports\" class=\"code-anchor\">imports</a></code> list.</p>\n<!-- KW--Does this mean that if we need it elsewhere we only import it at the top? I thought the services would all be available since we were importing it into `AppModule` in `providers`. -->\n<h2 id=\"prevent-reimport-of-the-coremodule\">Prevent reimport of the <code>CoreModule</code><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/singleton-services#prevent-reimport-of-the-coremodule\"><i class=\"material-icons\">link</i></a></h2>\n<p>Only the root <code>AppModule</code> should import the <code>CoreModule</code>. If a\nlazy-loaded module imports it too, the app can generate\n<a href=\"guide/ngmodule-faq#q-why-bad\">multiple instances</a> of a service.</p>\n<p>To guard against a lazy-loaded module re-importing <code>CoreModule</code>, add the following <code>CoreModule</code> constructor.</p>\n<code-example path=\"ngmodules/src/app/core/core.module.ts\" region=\"ctor\" header=\"src/app/core/core.module.ts\" linenums=\"false\">\nconstructor (@<a href=\"api/core/Optional\" class=\"code-anchor\">Optional</a>() @<a href=\"api/core/SkipSelf\" class=\"code-anchor\">SkipSelf</a>() parentModule: CoreModule) {\n  if (parentModule) {\n    throw new Error(\n      'CoreModule is already loaded. Import it in the AppModule only');\n  }\n}\n\n</code-example>\n<p>The constructor tells Angular to inject the <code>CoreModule</code> into itself.\nThe injection would be circular if Angular looked for\n<code>CoreModule</code> in the <em>current</em> injector. The <code>@<a href=\"api/core/SkipSelf\" class=\"code-anchor\">SkipSelf</a></code>\ndecorator means \"look for <code>CoreModule</code> in an ancestor\ninjector, above me in the injector hierarchy.\"</p>\n<p>If the constructor executes as intended in the <code>AppModule</code>,\nthere would be no ancestor injector that could provide an instance of <code>CoreModule</code> and the injector should give up.</p>\n<p>By default, the injector throws an error when it can't\nfind a requested provider.\nThe <code>@<a href=\"api/core/Optional\" class=\"code-anchor\">Optional</a></code> decorator means not finding the service is OK.\nThe injector returns <code>null</code>, the <code>parentModule</code> parameter is null,\nand the constructor concludes uneventfully.</p>\n<p>It's a different story if you improperly import <code>CoreModule</code> into a lazy-loaded module such as <code>CustomersModule</code>.</p>\n<p>Angular creates a lazy-loaded module with its own injector,\na <em>child</em> of the root injector.\n<code>@<a href=\"api/core/SkipSelf\" class=\"code-anchor\">SkipSelf</a></code> causes Angular to look for a <code>CoreModule</code> in the parent injector, which this time is the root injector.\nOf course it finds the instance imported by the root <code>AppModule</code>.\nNow <code>parentModule</code> exists and the constructor throws the error.</p>\n<p>Here are the two files in their entirety for reference:</p>\n<code-tabs linenums=\"false\">\n <code-pane header=\"app.module.ts\" path=\"ngmodules/src/app/app.module.ts\">\nimport { <a href=\"api/platform-browser/BrowserModule\" class=\"code-anchor\">BrowserModule</a> } from '@angular/platform-browser';\nimport { <a href=\"api/core/NgModule\" class=\"code-anchor\">NgModule</a> } from '@angular/core';\n\n/* App Root */\nimport { AppComponent } from './app.component';\n\n/* Feature Modules */\nimport { ContactModule } from './contact/contact.module';\nimport { CoreModule } from './core/core.module';\n\n/* Routing Module */\nimport { AppRoutingModule } from './app-routing.module';\n\n\n@<a href=\"api/core/NgModule\" class=\"code-anchor\">NgModule</a>({\n  <a href=\"api/core/NgModule#imports\" class=\"code-anchor\">imports</a>: [\n    <a href=\"api/platform-browser/BrowserModule\" class=\"code-anchor\">BrowserModule</a>,\n    ContactModule,\n    CoreModule.forRoot({userName: 'Miss Marple'}),\n    AppRoutingModule\n  ],\n  providers: [],\n  <a href=\"api/core/NgModule#declarations\" class=\"code-anchor\">declarations</a>: [\n    AppComponent\n  ],\n  <a href=\"api/core/NgModule#bootstrap\" class=\"code-anchor\">bootstrap</a>: [AppComponent]\n})\nexport class AppModule { }\n\n\n</code-pane>\n <code-pane header=\"core.module.ts\" region=\"whole-core-module\" path=\"ngmodules/src/app/core/core.module.ts\">\nimport { <a href=\"api/core/ModuleWithProviders\" class=\"code-anchor\">ModuleWithProviders</a>, <a href=\"api/core/NgModule\" class=\"code-anchor\">NgModule</a>, <a href=\"api/core/Optional\" class=\"code-anchor\">Optional</a>, <a href=\"api/core/SkipSelf\" class=\"code-anchor\">SkipSelf</a> } from '@angular/core';\n\nimport { <a href=\"api/common/CommonModule\" class=\"code-anchor\">CommonModule</a> } from '@angular/common';\n\nimport { TitleComponent } from './title.component';\nimport { UserService } from './user.service';\nimport { UserServiceConfig } from './user.service';\n\n\n@<a href=\"api/core/NgModule\" class=\"code-anchor\">NgModule</a>({\n  <a href=\"api/core/NgModule#imports\" class=\"code-anchor\">imports</a>:      [ <a href=\"api/common/CommonModule\" class=\"code-anchor\">CommonModule</a> ],\n  <a href=\"api/core/NgModule#declarations\" class=\"code-anchor\">declarations</a>: [ TitleComponent ],\n  <a href=\"api/core/NgModule#exports\" class=\"code-anchor\">exports</a>:      [ TitleComponent ],\n  providers:    [ UserService ]\n})\nexport class CoreModule {\n  constructor (@<a href=\"api/core/Optional\" class=\"code-anchor\">Optional</a>() @<a href=\"api/core/SkipSelf\" class=\"code-anchor\">SkipSelf</a>() parentModule: CoreModule) {\n    if (parentModule) {\n      throw new Error(\n        'CoreModule is already loaded. Import it in the AppModule only');\n    }\n  }\n\n  <a href=\"api/upgrade/static\" class=\"code-anchor\">static</a> forRoot(<a href=\"api/router/Router#config\" class=\"code-anchor\">config</a>: UserServiceConfig): <a href=\"api/core/ModuleWithProviders\" class=\"code-anchor\">ModuleWithProviders</a> {\n    return {\n      ngModule: CoreModule,\n      providers: [\n        {provide: UserServiceConfig, useValue: <a href=\"api/router/Router#config\" class=\"code-anchor\">config</a> }\n      ]\n    };\n  }\n}\n\n</code-pane>\n</code-tabs>\n<hr>\n<h2 id=\"more-on-ngmodules\">More on NgModules<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/singleton-services#more-on-ngmodules\"><i class=\"material-icons\">link</i></a></h2>\n<p>You may also be interested in:</p>\n<ul>\n<li><a href=\"guide/sharing-ngmodules\">Sharing Modules</a>, which elaborates on the concepts covered on this page.</li>\n<li><a href=\"guide/lazy-loading-ngmodules\">Lazy Loading Modules</a>.</li>\n<li><a href=\"guide/ngmodule-faq\">NgModule FAQ</a>.</li>\n</ul>\n\n</div>\n\n<!-- links to this doc:\n - guide/creating-libraries\n - guide/ngmodule-faq\n - guide/providers\n - guide/router\n-->\n<!-- links from this doc:\n - api/common/CommonModule\n - api/core/Injectable\n - api/core/Injectable#providedIn\n - api/core/ModuleWithProviders\n - api/core/NgModule\n - api/core/NgModule#bootstrap\n - api/core/NgModule#declarations\n - api/core/NgModule#exports\n - api/core/NgModule#imports\n - api/core/NgModule#providers\n - api/core/Optional\n - api/core/SkipSelf\n - api/platform-browser/BrowserModule\n - api/router/Router\n - api/router/Router#config\n - api/router/RouterModule\n - api/router/RouterModule#forRoot\n - api/router/RouterOutlet\n - api/upgrade/static\n - guide/bootstrapping\n - guide/lazy-loading-ngmodules\n - guide/ngmodule-faq\n - guide/ngmodule-faq#q-why-bad\n - guide/providers\n - guide/sharing-ngmodules\n - guide/singleton-services#forroot\n - guide/singleton-services#more-on-ngmodules\n - guide/singleton-services#prerequisites\n - guide/singleton-services#prevent-reimport-of-the-coremodule\n - guide/singleton-services#providing-a-singleton-service\n - guide/singleton-services#singleton-services\n - tutorial\n - tutorial/toh-pt4\n - https://github.com/angular/angular/edit/master/aio/content/guide/singleton-services.md?message=docs%3A%20describe%20your%20change...\n-->"
}